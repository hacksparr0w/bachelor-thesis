variable target_temperature getenv "MD_TARGET_TEMPERATURE"
variable volume_scale getenv "MD_VOLUME_SCALE"
variable model getenv "MD_DEEPMD_MODEL"

units metal
atom_style atomic
boundary p p p

variable size_scale equal ${volume_scale}^(1/3)

read_data ml4md/amorphous_structure.dat

pair_style deepmd ${model}
pair_coeff * *
neigh_modify every 1 check yes
mass 1 28.08

compute atom_potential_energy all pe/atom
compute total_potential_energy all reduce sum c_atom_potential_energy

fix 1 all nvt temp 1e-10 ${target_temperature} 0.01
timestep 0.001

thermo 10
thermo_style custom step lx ly lz press pxx pyy pzz c_total_potential_energy

run 10000
unfix 1

fix 2 all nve
fix 3 all deform 100 &
  x scale ${size_scale} &
  y scale ${size_scale} &
  z scale ${size_scale} &
  remap x &
  remap v &
  units box

run 10000

unfix 3

run 10000

variable total_potential_energy equal "c_total_potential_energy"
variable total_atoms equal "count(all)"
variable cohesive_energy equal "v_total_potential_energy / v_total_atoms"
variable final_volume equal "vol / v_total_atoms"

print "Total energy (eV) = ${total_potential_energy}"
print "Cohesive energy (eV) = ${cohesive_energy}"
print "Final volume (angstrom^3) = ${final_volume}"
